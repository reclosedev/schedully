#!/usr/bin/env python2
# -*- coding: utf-8 -*-
from __future__ import unicode_literals, print_function
import json

TARGET = "src/app/components/schedulesData/data.js"


locations = [
    {
        "id": "m-gorky",
        "type": "metro",
        "name": 'Метро "Горьковская"',
        "places": [
            {
                "name": "Вход с ул. Горького",
                "location": {"latitude": 56.314362, "longitude": 43.994766},
            }
        ],
        "schedules": [
            {
                "to": "m-moskovskaya",
                "times": """
5:31, 5:43, 5:50, 6:05, 6:18, 6:32, 6:44, 6:54, 7:03, 7:09, 7:15,
7:21, 7:27, 7:33, 7:39, 7:45, 7:52, 7:58, 8:04, 8:10, 8:16, 8:22, 8:28,
8:34, 8:40, 8:46, 8:52, 8:58, 9:04, 9:10, 9:16, 9:22, 9:28, 9:34, 9:40,
9:46, 9:52, 10:04, 10:16, 10:28, 10:40, 10:52,  11:04, 11:16, 11:28, 11:40,
11:52, 12:04, 12:16, 12:28, 12:40, 12:52, 13:04, 13:16, 13:28, 13:40, 13:52,
14:04, 14:16, 14:28, 14:40, 14:52, 15:04, 15:16, 15:25, 15:31, 15:37, 15:43,
15:49, 15:55, 16:01, 16:07, 16:13, 16:19, 16:25, 16:31, 16:37, 16:43, 16:49,
16:55, 17:01, 17:07, 17:13, 17:19,  17:25, 17:31, 17:37, 17:43, 17:49, 17:55,
18:01, 18:07, 18:13, 18:19, 18:25, 18:31, 18:37, 18:43, 18:49, 18:55, 19:01,
19:07, 19:13, 19:19, 19:25, 19:31, 19:37, 19:43, 19:49, 19:55, 20:01, 20:07,
20:13, 20:25, 20:37, 20:49, 21:01, 21:13, 21:25, 21:37, 21:51, 22:05, 22:17,
22:31, 22:53, 23:17, 23:40, 00:15
"""
            },
        ]
    },
    {
        "id": "m-moskovskaya",
        "type": "metro",
        "name": 'Метро "Московская"',
        "places": [
            {
                "name": "Вход с Вокзала",
                "location": {"latitude": 56.321376, "longitude": 43.945503},
            }
        ],
        "schedules": [
            {
                "to": "m-gorky",
                "times": """
5:20, 5:30, 5:41, 5:56, 6:09, 6:23, 6:35, 6:45, 6:54, 7:00, 7:06, 7:12, 7:18,
7:24, 7:30, 7:36, 7:43, 7:49, 7:55, 8:01, 8:07, 8:13, 8:19, 8:24, 8:31, 8:37,
8:43, 8:49, 8:55, 9:01, 9:07, 9:13, 9:19, 9:25, 9:31, 9:37, 9:43, 9:55, 10:07,
10:19, 10:31, 10:43, 10:55, 11:07, 11:19, 11:31, 11:43, 11:55, 12:07, 12:19, 12:31,
12:43, 12:55, 13:07, 13:19, 13:31, 13:43, 13:55, 14:07, 14:19, 14:31, 14:43,
14:55, 15:07, 15:16, 15:22, 15:28, 15:34, 15:40, 15:46, 15:52, 15:58, 16:04,
16:10, 16:16, 16:22, 16:28, 16:34, 16:40, 16:46, 16:52, 16:58, 17:04, 17:10,
17:16, 17:22, 17:28, 17:34, 17:40, 17:46, 17:52, 17:58, 18:04, 18:10, 18:16,
18:22, 18:28, 18:34, 18:40, 18:46, 18:52, 18:58, 19:04, 19:10, 19:16, 19:22,
19:28, 19:34, 19:40, 19:46, 19:52, 19:58, 20:04, 20:16, 20:28, 20:40, 20:52,
21:04, 21:16, 21:28, 21:40, 21:52, 22:04, 22:22, 22:39, 23:05, 23:28, 23:55, 00:16, 00:48
"""
            },
            {
                "to": "m-burevestnik",
                "times": """
5:20, 5:38, 5:53, 6:05, 6:20, 6:30, 6:42, 6:52, 7:05, 7:17, 7:29, 7:41, 7:54,
8:06, 8:18, 8:30, 8:42, 8:54, 9:06, 9:18, 9:30, 9:42, 9:52, 10:03, 10:07, 10:15,
10:27, 10:39, 10:51, 11:03, 11:15, 11:27, 11:39, 11:51, 12:03, 12:15, 12:27,
12:39, 12:51, 13:03, 13:15, 13:27, 13:39, 13:51, 14:03, 14:15, 14:27, 14:39,
14:51, 15:03, 15:15, 15:27, 15:39, 15:51, 16:03, 16:15, 16:27, 16:39, 16:51,
17:03, 17:15, 17:27, 17:39, 17:51, 18:03, 18:15, 18:27, 18:39, 18:51, 19:03,
19:15, 19:27, 19:39, 19:51, 20:03, 20:12, 20:24, 20:36, 20:48, 21:00, 21:12,
21:24, 21:36, 21:48, 22:00, 22:15, 22:31, 22:45, 23:10, 23:33, 23:54, 00:21, 00:47
                """
            },
        ]
    },
    {
        "id": "m-burevestnik",
        "type": "metro",
        "name": 'Метро "Бурувестник"',
        "places": [
            {
                "name": "Вход",
                "location": {"latitude": 56.3332749, "longitude": 43.8940854},
            }
        ],
        "schedules": [
            {
                "to": "m-moskovskaya",
                "times": """
5:32, 5:51, 6:06, 6:20, 6:34, 6:46, 6:55, 7:03, 7:15, 7:27, 7:39, 7:52, 8:04,
8:16, 8:28, 8:40, 8:52, 9:04, 9:16, 9:28, 9:40, 9:52, 10:05, 10:19, 10:31,
10:43, 10:55, 11:07, 11:19, 11:31, 11:43, 11:55, 12:07, 12:19, 12:31, 12:43,
12:55, 13:07, 13:19, 13:31, 13:43, 13:55, 14:07, 14:19, 14:31, 14:43, 14:55,
15:07, 15:18, 15:25, 15:37, 15:49, 16:01, 16:13, 16:25, 16:37, 16:49, 17:01,
17:13, 17:25, 17:37, 17:49, 18:01, 18:13, 18:25, 18:37, 18:49, 19:01, 19:13,
19:25, 19:37, 19:49, 20:01, 20:17, 20:28, 20:40, 20:52, 21:04, 21:16, 21:28,
21:40, 21:52, 22:05, 22:18, 22:31, 22:41, 22:55, 23:20, 23:43, 00:05
                """
            },
        ],
    },
    {
        "id": "v-nn-moskovsky",
        "type": "railway",
        "name": 'Вокзал "Московский" (НН)',
        "places": [
            {
                "name": "Вход",
                "location": {"latitude": 56.3217146, "longitude": 43.9460467},
            }
        ],

        "schedules": [
            # https://rasp.yandex.ru/search/suburban/?fromName=%D0%9D%D0%B8%D0%B6%D0%BD%D0%B8%D0%B9+%D0%9D%D0%BE%D0%B2%D0%B3%D0%BE%D1%80%D0%BE%D0%B4+%28%D0%9C%D0%BE%D1%81%D0%BA%D0%BE%D0%B2%D1%81%D0%BA%D0%B8%D0%B9+%D0%B2%D0%BE%D0%BA%D0%B7%D0%B0%D0%BB%29&fromId=&toName=%D0%94%D0%B7%D0%B5%D1%80%D0%B6%D0%B8%D0%BD%D1%81%D0%BA&toId=c972&when=%D0%BD%D0%B0+%D0%B2%D1%81%D0%B5+%D0%B4%D0%BD%D0%B8
            # $(".b-timetable__cell_type_departure>span").map(function(i, x){return $(x).text()}).toArray().join(", ")
            {
                "to": "v-dzerzhinsk",
                "times": """
05:00, 05:50, 06:28, 07:20, 08:30, 10:05, 12:53, 14:18, 15:20,
16:00, 16:20, 16:30, 17:19, 17:27, 18:25, 19:30, 20:30, 21:50
                """
            },
        ],
    },
    {
        "id": "v-dzerzhinsk",
        "type": "railway",
        "name": 'Вокзал Дзержинск',
        "places": [
            {
                "name": "Вход",
                "location": {"latitude": 56.228459, "longitude": 43.454128},
            }
        ],

        "schedules": [
            {
                "to": "v-nn-moskovsky",
                "times": """
05:15, 05:55, 06:25, 06:35, 07:02, 07:33, 07:44, 08:32, 09:08,
09:18, 10:28, 14:30, 15:05, 16:22, 17:30, 17:58, 19:11, 19:59, 20:53
                """
            },
        ],
    },
    {
        "id": "a-401k-dzr",
        "type": "auto",
        "name": 'Транслайн Дзержинск',
        "places": [
            {
                "name": "У Шпиля",
                "location": {"latitude": 56.244057, "longitude": 43.463199},
                "time_offset": 10 * 60,
            },
            {
                "name": "8 мкр",
                "location": {"latitude": 56.226783, "longitude": 43.392535},
                "time_offset": 0,
            }
        ],
        "schedules": [
            {
                "to": "a-401k-nn",
                "times": """
05:35, 05:43, 05:51, 05:59, 06:07, 06:15, 06:23, 06:31, 06:39, 06:47, 06:55, 07:03, 07:11,
07:19, 07:27, 07:35, 07:43, 07:51, 07:59, 08:07, 08:15, 08:23, 08:31, 08:39, 08:47, 08:55,
09:03, 09:11, 09:19, 09:27, 09:35, 09:43, 09:51, 09:59, 10:07, 10:15, 10:53, 11:01, 11:09,
11:17, 11:25, 11:33, 11:41, 11:49, 11:57, 12:05, 12:13, 12:21, 12:29, 12:37, 12:45, 12:53,
13:01, 13:09, 13:17, 13:25, 13:37, 13:45, 13:53, 14:01, 14:09, 14:17, 14:25, 14:33, 14:41,
14:49, 14:57, 15:05, 15:13, 15:21, 15:29, 15:37, 15:45, 15:53, 16:01, 16:09, 16:25, 16:41,
16:47, 16:57, 17:03, 17:13, 17:19, 17:29, 17:35, 17:45, 17:51, 18:01, 18:07, 18:17, 18:23,
18:33, 18:39, 18:49, 18:55, 19:11, 19:27, 19:35, 19:43, 19:51, 19:59, 20:07, 20:23, 20:39,
20:55, 21:19
                """
            },
        ],
    },
    {
        "id": "a-401k-nn",
        "type": "auto",
        "name": 'Транслайн НН',
        "places": [
            {
                "name": "На стоянке",
                "location": {"latitude": 56.244057, "longitude": 43.463199},
            }
        ],
        "schedules": [
            {
                "to": "a-401k-dzr",
                "times": """
6:55, 7:11, 7:27, 7:43, 7:51, 7:59, 8:07, 8:15, 8:23, 8:31, 8:39, 8:47, 8:55, 9:11, 9:27, 9:33, 9:43,
9:49, 9:59, 10:05, 10:15, 10:21, 10:31, 10:37, 10:47, 10:53, 11:03, 11:09, 11:19, 11:25, 11:35,
11:41, 11:57, 15:05, 15:13, 15:21, 15:29, 15:37, 15:45, 15:53, 16:01, 16:09, 16:17, 16:25, 16:33, 
16:41, 16:49, 16:57, 17:05, 17:13, 17:21, 17:29, 18:07, 18:15, 18:23, 18:31, 18:39, 18:47, 18:55, 
19:03, 19:11, 19:19, 19:27, 19:35, 19:43, 19:51, 19:59, 20:07, 20:15, 20:23, 20:31, 20:39, 20:47, 
20:55, 21:03, 21:11, 21:19, 21:27, 21:43, 21:59, 22:15, 22:39
                """
            },
        ],
    },

]


def main():
    for location in locations:
        for entry in location["schedules"]:
            times = entry["times"].replace("\n", " ").replace(": ", ":")
            times = [x.strip() for x in times.split(",")]
            times = [list(map(int, x.split(":"))) for x in times]
            entry["times"] = times

    data = "(function(){window.APP_DB = %s})();" % json.dumps({"locations": locations})
    with open(TARGET, "w") as fp:
        fp.write(data)


if __name__ == "__main__":
    main()
